#
#                                            prg/cobra_serv/Makefile.in
#
Depend_on 			= 			$(Clip_L_Dir)/libclip-codb.so 	\
									$(Clip_L_Dir)/libclip-r2d2.so
CLIPFLAGS 			+= 		-n
LIBS  				= 			-lclip-codb -lclip-r2d2
MODULES 				= 			$(sort 						\
												module1.po 		\
												codbtview.po 	\
												codbdlist.po	\
									)
DIRS_TO_SCAN 		= 			auth mod-ini tcp-wrap

export

######################################################################################
###################################################################################### local rules

all : Makefile $(DIRS_TO_SCAN) $(OBJS) cobra_serv$(EXESUFF) $(MODULES)

hash1 :

cfg :

cleanc : $(DIRS_TO_SCAN)
	$(E_rm)rm -f$(V) *.c *.b
	$(E_rm)rm -f$(V) cobra_serv$(EXESUFF) *.pro

distcleanc :
	$(E_rm)rm -rf$(V) *.g

cobra_serv$(EXESUFF) :cobra_serv.prg $(OBJS) $(MODULES) Makefile $(CLIP) $(LIBCLIP) $(Depend_on)
	$(E_clip)if [ -f $(subst .prg,.g,$<) ] ; then 					\
		$(Trace_clip_d) 	;													\
		$(CLIP) $(CLIPFLAGS) -g -o $@ -es $< $(OBJS)  $(LIBS) ; 	\
	else 																			\
		$(Trace_clip) 	;														\
		$(CLIP) $(CLIPFLAGS) -o $@ -es $< $(OBJS) $(LIBS) ;		\
	fi

install: all
	$(E_mkD)mkdir -p$(V) $(INSTDIR)/cobra
	$(E_cp)cp --remove-destination -fpu$(V) cobra_serv$(EXESUFF) $(Clip_B_Dir)/
	$(E_cp)cp --remove-destination -fpu$(V) cobra_serv$(EXESUFF) $(INSTDIR)/cobra/
	$(E_cp)cp --remove-destination -fpu$(V) cobra_serv.ini $(INSTDIR)/cobra
	$(E_mkD)mkdir -p$(V) $(INSTDIR)/cobra/mod-ini
	$(E_cp)cp --remove-destination -fpu$(V) ./mod-ini/Makefile ./mod-ini/*.po ./mod-ini/*.prg $(INSTDIR)/cobra/mod-ini
	$(E_mkD)mkdir -p$(V) $(INSTDIR)/cobra/tcp-wrap
	$(E_cp)cp --remove-destination -fpu$(V) ./tcp-wrap/Makefile ./tcp-wrap/tcp-* $(INSTDIR)/cobra/tcp-wrap
	$(E_cp)cp --remove-destination -fpu$(V) $(MODULES) $(INSTDIR)/cobra/
	$(E_mkD)mkdir -p$(V) $(INSTDIR)/cobra/files
	$(E_cp)cp --remove-destination -fpu$(V) ./auth/pam-err-msg $(INSTDIR)/cobra/files

include $(Makefile_o_in)

include $(Makefile_end_in)

