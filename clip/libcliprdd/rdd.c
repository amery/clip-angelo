/*
	Copyright (C) 2001  ITK
	Author  : Rushad Nabiullin <rust@itk.ru>,Pavel Lasarev (paul@itk.ru)
	License : (GPL) http://www.itk.ru/clipper/license.html

	Start total new system v. 0.0
	with hard coded long name variables to have clear system
	Angelo GIRARDI
*/
#include <ctype.h>
#include <unistd.h>
#include <errno.h>
#include <fcntl.h>
#include <sys/stat.h>
#include <string.h>
#include <limits.h>
#include <time.h>
#include <ci_rdd.h>
#include <ci_coll.h>
#include <ci_charset.h>
#include <ci_error.ch>
#include <ci_six.ch>
#include <ci_btree.h>
#ifdef USE_TASKS
#include <ci_task.h>
#endif
#ifdef HAVE_MMAN_H
#include <sys/mman.h>
#endif

#include <ci_ncp.h>

#ifdef USE_NCPFS
#define fcntl ncp_fcntl
#endif

#define CHECKII(i) \
	if(!(i)) \
		return rdd_err(ClipMachineMemory,EG_ARG,0,__FILE__,__LINE__,__PROC__,"Bad independed index handle"); \

#define CHECKIO(o) \
	if(!(o)) \
		return rdd_err(ClipMachineMemory,EG_ARG,0,__FILE__,__LINE__,__PROC__,"Bad independed order handle"); \

#define er_badinstance      _clip_gettext("Bad RDD instance")
#define er_badfilterexpr    _clip_gettext("Bad filter expression")
#define er_badrelationexpr  _clip_gettext("Bad relation expression")
#define er_badforexpr       _clip_gettext("Bad FOR expression")
#define er_ioerror          _clip_gettext("I/O error")
#define er_badstructure     _clip_gettext("Bad table structure")
#define er_badfield         _clip_gettext("Bad field")
#define er_notpermitted     _clip_gettext("Operation not permitted")
#define er_noorder          _clip_gettext("No controlling order")
#define er_nofield          _clip_gettext("No such field")

#include <rdd/rdd_flushbuffer.c>
#include <rdd/clip_INIT_RDD.c>
#include <rdd/rdd_registerdatadriver.c>
#include <rdd/rdd_registerindexdriver.c>
#include <rdd/rdd_registermemodriver.c>
#include <rdd/rdd_datadriver.c>
#include <rdd/rdd_indexdriver.c>
#include <rdd/rdd_memodriver.c>
#include <rdd/loc_read.c>
#include <rdd/loc_write.c>
#include <rdd/loc_cmp.c>
#include <rdd/_rdd_fieldno.c>
#include <rdd/_clip_rddfieldno.c>
#include <rdd/static__rdd_freebuf.c>
#include <rdd/rdd_open.c>
#include <rdd/rdd_calc.c>
#include <rdd/rdd_takevalue.c>
#include <rdd/_clip_rddfield.c>
#include <rdd/rdd_err.c>
#include <rdd/rdd_expandmacro.c>
#include <rdd/rdd_calcfilter.c>
#include <rdd/rdd_checkfilter.c>
#include <rdd/rdd_checkifnew.c>
#include <rdd/rdd_childs.c>
#include <rdd/rdd_child_duty.c>
#include <rdd/_rdd_read.c>
#include <rdd/_rdd_write.c>
#include <rdd/_rdd_trunc.c>
#include <rdd/_rdd_read64.c>
#include <rdd/_rdd_write64.c>
#include <rdd/_rdd_trunc64.c>
#include <rdd/rdd_create.c>
#include <rdd/rdd_creatememo.c>
#include <rdd/rdd_pack.c>
#include <rdd/rdd_zap.c>
#include <rdd/rdd_usearea.c>
#include <rdd/rdd_setindex.c>
#include <rdd/rdd_setmemo.c>
#include <rdd/rdd_createindex.c>
#include <rdd/rdd_reindex.c>
#include <rdd/rdd_orddestroy.c>
#include <rdd/rdd_setorder.c>
#include <rdd/rdd_closearea.c>
#include <rdd/rdd_gotop.c>
#include <rdd/rdd_gobottom.c>
#include <rdd/rdd_skip.c>
#include <rdd/rdd_seek.c>
#include <rdd/rdd_goto.c>
#include <rdd/rdd_gotokey.c>
#include <rdd/rdd_bof.c>
#include <rdd/rdd_eof.c>
#include <rdd/rdd_recno.c>
#include <rdd/rdd_lastrec.c>
#include <rdd/rdd_keyno.c>
#include <rdd/rdd_lastkey.c>
#include <rdd/rdd_fieldname.c>
#include <rdd/rdd_append.c>
#include <rdd/rdd_getvaluebn.c>
#include <rdd/rdd_getvalue.c>
#include <rdd/rdd_setvaluebn.c>
#include <rdd/rdd_setvalue.c>
#include <rdd/_rdd_calcfiltlist.c>
#include <rdd/rdd_initrushmore.c>
#include <rdd/rdd_createuserfilter.c>
#include <rdd/rdd_createfilter.c>
#include <rdd/rdd_setrelation.c>
#include <rdd/rdd_delete.c>
#include <rdd/rdd_recall.c>
#include <rdd/rdd_deleted.c>
#include <rdd/rdd_clearindex.c>
#include <rdd/rdd_destroyfilter.c>
#include <rdd/rdd_clearfilter.c>
#include <rdd/static__rdd_clearparent.c>
#include <rdd/rdd_clearrelation.c>
#include <rdd/rdd_rlock.c>
#include <rdd/rdd_flock.c>
#include <rdd/rdd_ulock.c>
#include <rdd/rdd_commit.c>
#include <rdd/rdd_dbread.c>
#include <rdd/rdd_dbwrite.c>
#include <rdd/rdd_scopetop.c>
#include <rdd/rdd_scopebottom.c>
#include <rdd/rdd_keyadd.c>
#include <rdd/rdd_keydel.c>
#include <rdd/rdd_keyvalue.c>
#include <rdd/rdd_locate.c>
#include <rdd/rdd_continue.c>
#include <rdd/destroy_rdd_data.c>
#include <rdd/destroy_rdd_index.c>
#include <rdd/destroy_rdd_memo.c>
#include <rdd/destroy_rdd_order.c>
#include <rdd/destroy_rdd_i_order.c>
#include <rdd/destroy_ryo.c>
#include <rdd/_rdd_uint.c>
#include <rdd/_rdd_ushort.c>
#include <rdd/_rdd_put_uint.c>
#include <rdd/_rdd_put_ushort.c>
#include <rdd/_rdd_backuint.c>
#include <rdd/_rdd_backushort.c>
#include <rdd/_rdd_put_backuint.c>
#include <rdd/_rdd_put_backushort.c>
static DbfLocale koi_locale = {
/*unsigned char _koi_cmptbl[] = */
   {
    0xc4, 0xb3, 0xda, 0xbf, 0xc0, 0xd9, 0xc3, 0xb4,
    0xc2, 0xc1, 0xc5, 0xdf, 0xdc, 0xdb, 0xdd, 0xde,
    0xb0, 0xb1, 0xb2, 0xf4, 0xfe, 0xf9, 0xfb, 0xf7,
    0xf3, 0xf2, 0xff, 0xf5, 0xf8, 0xfd, 0xfa, 0xf6,
    0xcd, 0xba, 0xd5, 0xf1, 0xd6, 0xc9, 0xb8, 0xb7,
    0xbb, 0xd4, 0xd3, 0xc8, 0xbe, 0xbd, 0xbc, 0xc6,
    0xc7, 0xcc, 0xb5, 0xf0, 0xb6, 0xb9, 0xd1, 0xd2,
    0xcb, 0xcf, 0xd0, 0xca, 0xd8, 0xd7, 0xce, 0xfc,
    0xee, 0xa0, 0xa1, 0xe6, 0xa4, 0xa5, 0xe4, 0xa3,
    0xe5, 0xa8, 0xa9, 0xaa, 0xab, 0xac, 0xad, 0xae,
    0xaf, 0xef, 0xe0, 0xe1, 0xe2, 0xe3, 0xa6, 0xa2,
    0xec, 0xeb, 0xa7, 0xe8, 0xed, 0xe9, 0xe7, 0xea,
    0x9e, 0x80, 0x81, 0x96, 0x84, 0x85, 0x94, 0x83,
    0x95, 0x88, 0x89, 0x8a, 0x8b, 0x8c, 0x8d, 0x8e,
    0x8f, 0x9f, 0x90, 0x91, 0x92, 0x93, 0x86, 0x82,
    0x9c, 0x9b, 0x87, 0x98, 0x9d, 0x99, 0x97, 0x9a},

/*unsigned char _koi_uptbl[] = */
   {
    0x80, 0x81, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87,
    0x88, 0x89, 0x8a, 0x8b, 0x8c, 0x8d, 0x8e, 0x8f,
    0x90, 0x91, 0x92, 0x93, 0x94, 0x95, 0x96, 0x97,
    0x98, 0x99, 0x9a, 0x9b, 0x9c, 0x9d, 0x9e, 0x9f,
    0xa0, 0xa1, 0xa2, 0xa3, 0xa4, 0xa5, 0xa6, 0xa7,
    0xa8, 0xa9, 0xaa, 0xab, 0xac, 0xad, 0xae, 0xaf,
    0xb0, 0xb1, 0xb2, 0xb3, 0xb4, 0xb5, 0xb6, 0xb7,
    0xb8, 0xb9, 0xba, 0xbb, 0xbc, 0xbd, 0xbe, 0xbf,
    0xe0, 0xe1, 0xe2, 0xe3, 0xe4, 0xe5, 0xe6, 0xe7,
    0xe8, 0xe9, 0xea, 0xeb, 0xec, 0xed, 0xee, 0xef,
    0xf0, 0xf1, 0xf2, 0xf3, 0xf4, 0xf5, 0xf6, 0xf7,
    0xf8, 0xf9, 0xfa, 0xfb, 0xfc, 0xfd, 0xfe, 0xff,
    0xe0, 0xe1, 0xe2, 0xe3, 0xe4, 0xe5, 0xe6, 0xe7,
    0xe8, 0xe9, 0xea, 0xeb, 0xec, 0xed, 0xee, 0xef,
    0xf0, 0xf1, 0xf2, 0xf3, 0xf4, 0xf5, 0xf6, 0xf7,
    0xf8, 0xf9, 0xfa, 0xfb, 0xfc, 0xfd, 0xfe, 0xff,
    },

/*unsigned char _koi_lowtbl[] = */
   {
    0x80, 0x81, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87,
    0x88, 0x89, 0x8a, 0x8b, 0x8c, 0x8d, 0x8e, 0x8f,
    0x90, 0x91, 0x92, 0x93, 0x94, 0x95, 0x96, 0x97,
    0x98, 0x99, 0x9a, 0x9b, 0x9c, 0x9d, 0x9e, 0x9f,
    0xa0, 0xa1, 0xa2, 0xa3, 0xa4, 0xa5, 0xa6, 0xa7,
    0xa8, 0xa9, 0xaa, 0xab, 0xac, 0xad, 0xae, 0xaf,
    0xb0, 0xb1, 0xb2, 0xb3, 0xb4, 0xb5, 0xb6, 0xb7,
    0xb8, 0xb9, 0xba, 0xbb, 0xbc, 0xbd, 0xbe, 0xbf,
    0xc0, 0xc1, 0xc2, 0xc3, 0xc4, 0xc5, 0xc6, 0xc7,
    0xc8, 0xc9, 0xca, 0xcb, 0xcc, 0xcd, 0xce, 0xcf,
    0xd0, 0xd1, 0xd2, 0xd3, 0xd4, 0xd5, 0xd6, 0xd7,
    0xd8, 0xd9, 0xda, 0xdb, 0xdc, 0xdd, 0xde, 0xdf,
    0xc0, 0xc1, 0xc2, 0xc3, 0xc4, 0xc5, 0xc6, 0xc7,
    0xc8, 0xc9, 0xca, 0xcb, 0xcc, 0xcd, 0xce, 0xcf,
    0xd0, 0xd1, 0xd2, 0xd3, 0xd4, 0xd5, 0xd6, 0xd7,
    0xd8, 0xd9, 0xda, 0xdb, 0xdc, 0xdd, 0xde, 0xdf,
    },
   {
    0x80, 0x81, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87,
    0x88, 0x89, 0x8a, 0x8b, 0x8c, 0x8d, 0x8e, 0x8f,
    0x90, 0x91, 0x92, 0x93, 0x94, 0x95, 0x96, 0x97,
    0x98, 0x99, 0x9a, 0x9b, 0x9c, 0x9d, 0x9e, 0x9f,
    0xa0, 0xa1, 0xa2, 0xa3, 0xa4, 0xa5, 0xa6, 0xa7,
    0xa8, 0xa9, 0xaa, 0xab, 0xac, 0xad, 0xae, 0xaf,
    0xb0, 0xb1, 0xb2, 0xb3, 0xb4, 0xb5, 0xb6, 0xb7,
    0xb8, 0xb9, 0xba, 0xbb, 0xbc, 0xbd, 0xbe, 0xbf,
    0xc0, 0xc1, 0xc2, 0xc3, 0xc4, 0xc5, 0xc6, 0xc7,
    0xc8, 0xc9, 0xca, 0xcb, 0xcc, 0xcd, 0xce, 0xcf,
    0xd0, 0xd1, 0xd2, 0xd3, 0xd4, 0xd5, 0xd6, 0xd7,
    0xd8, 0xd9, 0xda, 0xdb, 0xdc, 0xdd, 0xde, 0xdf,
    0xe0, 0xe1, 0xe2, 0xe3, 0xe4, 0xe5, 0xe6, 0xe7,
    0xe8, 0xe9, 0xea, 0xeb, 0xec, 0xed, 0xee, 0xef,
    0xf0, 0xf1, 0xf2, 0xf3, 0xf4, 0xf5, 0xf6, 0xf7,
    0xf8, 0xf9, 0xfa, 0xfb, 0xfc, 0xfd, 0xfe, 0xff,
    },
   {
    0x80, 0x81, 0x82, 0x83, 0x84, 0x85, 0x86, 0x87,
    0x88, 0x89, 0x8a, 0x8b, 0x8c, 0x8d, 0x8e, 0x8f,
    0x90, 0x91, 0x92, 0x93, 0x94, 0x95, 0x96, 0x97,
    0x98, 0x99, 0x9a, 0x9b, 0x9c, 0x9d, 0x9e, 0x9f,
    0xa0, 0xa1, 0xa2, 0xa3, 0xa4, 0xa5, 0xa6, 0xa7,
    0xa8, 0xa9, 0xaa, 0xab, 0xac, 0xad, 0xae, 0xaf,
    0xb0, 0xb1, 0xb2, 0xb3, 0xb4, 0xb5, 0xb6, 0xb7,
    0xb8, 0xb9, 0xba, 0xbb, 0xbc, 0xbd, 0xbe, 0xbf,
    0xc0, 0xc1, 0xc2, 0xc3, 0xc4, 0xc5, 0xc6, 0xc7,
    0xc8, 0xc9, 0xca, 0xcb, 0xcc, 0xcd, 0xce, 0xcf,
    0xd0, 0xd1, 0xd2, 0xd3, 0xd4, 0xd5, 0xd6, 0xd7,
    0xd8, 0xd9, 0xda, 0xdb, 0xdc, 0xdd, 0xde, 0xdf,
    0xe0, 0xe1, 0xe2, 0xe3, 0xe4, 0xe5, 0xe6, 0xe7,
    0xe8, 0xe9, 0xea, 0xeb, 0xec, 0xed, 0xee, 0xef,
    0xf0, 0xf1, 0xf2, 0xf3, 0xf4, 0xf5, 0xf6, 0xf7,
    0xf8, 0xf9, 0xfa, 0xfb, 0xfc, 0xfd, 0xfe, 0xff,
    }
};

#include <rdd/typedef_struct_LocData.h>
#include <rdd/static_cmp_locale.c>
#include <rdd/dbf_get_locale.c>
#include <rdd/rdd_ii_create.c>
#include <rdd/rdd_ii_createtag.c>
#include <rdd/rdd_ii_open.c>
#include <rdd/rdd_ii_opentag.c>
#include <rdd/rdd_ii_close.c>
#include <rdd/rdd_ii_closetag.c>
#include <rdd/rdd_ii_addkey.c>
#include <rdd/rdd_ii_delkey.c>
#include <rdd/rdd_ii_gotop.c>
#include <rdd/rdd_ii_gobottom.c>
#include <rdd/rdd_ii_bof.c>
#include <rdd/rdd_ii_eof.c>
#include <rdd/rdd_ii_id.c>
#include <rdd/rdd_ii_key.c>
#include <rdd/rdd_ii_skip.c>
#include <rdd/rdd_event.c>
#include <rdd/_rdd_parsepath.c>
#include <rdd/rdd_seekeval.c>
#include <rdd/static__rdd_wildskip.c>
#include <rdd/rdd_wildseek.c>
#include <rdd/rdd_rawread.c>
#include <rdd/rdd_rawwrite.c>
