##
##										new-xDevil/Makefile.in
##
DIRS_TO_SCAN 		= 									\
									include 				\
									tools 				\
									compiler 			\
									libxDevilclasses 	\
									libxDevildbfsql 		\
									libxDevilfunctions 	\
									libxDevilmain 		\
									libxDevilrdd 			\
									libxDevilscreen 		\
									libxDeviltask 		\
									libxDevil

DBGLIB =

export

######################################################################################
###################################################################################### local rules

all : Makefile $(DIRS_TO_SCAN)

cfg : inst_dir inst_screen links
	$(E_cp)cp -f$(V) ../Makefile.ini ../configure.ini .
	$(E_mkD)[ -d $(xDevilROOT)/db ] \
		|| mkdir -p$(V) $(xDevilROOT)/db
	$(E_cp)cp -Rfpu$(V) $(xDevil_M_Dir)/db/* $(xDevilROOT)/db/ || true

hash1 :
#Makefile $(DIRS_TO_SCAN)

links :
	$(E_ln)[ -d charsets ] || ln -sf$(V) $(xDevilROOT)/charsets .

trans : xDevil_trans inst_dir inst_screen

xDevil.1 : xDevil.html
	htex -o man xDevil.html

cleanc : $(DIRS_TO_SCAN)
	$(E_rm)rm -f$(V) *.ex *.nm charsets
	$(E_rm)rm -Rf$(V) bin
	$(E_rm)rm -f$(V) 	$(BINS) 		\
							*.out 		\
							*.o 			\
							*.a 			\
							*.so 			\
							*.dll 		\
							*.pa 			\
							*.b 			\
							*.BAK 		\
							*.bak 		\
							*~ core* 	\
							*core			\
							*.output 	\
							dtest 		\
							bin 			\
							*.exe 		\
							locale.pot 	\
							license.h

distcleanc : clean
	$(E_rm)rm -f$(V) configure.flags
	$(E_rm)rm -f$(V) Makefile

cleantest :
	$(E_rm)rm -f$(V) dtest *.pa test.o dtest.o
#	$(E_rm)cd test && $(MAKE) clean

pot :
	mkdir -p locale.pot/xDevil
	xgettext --language=C \
		 --keyword \
		 --keyword=yyerror \
		 --keyword=yywarning \
		 --keyword=v_printf:2 \
		 --keyword=_clic_gettext \
		 --keyword=_clic_ngettext:1,2 \
		 --keyword=_clic_ngettext:2 \
		 --omit-header --output=locale.pot/xDevil/xDevil.pot \
		 *.c
	mkdir -p locale.pot/xDevilrt
	xgettext --language=C \
		 --keyword \
		 --keyword=_xDevil_gettext \
		 --keyword=_xDevil_logg:2 \
		 --keyword=_xDevil_trap_str:4 \
		 --keyword=_xDevil_trap_printf:4 \
		 --keyword=_xDevil_trap_printv:4 \
		 --omit-header --output=locale.pot/xDevilrt/xDevilrt.pot \
		 *.c libnxDevilrdd/*.c libnxDevilscreen/*.c
	xDevil_LOCALE_ROOT=`pwd` tools/xDevil_msgmerge$(SCRIPTSUFF)


install : all

inst_dir :
	$(E_mkD)[ -d $(INSTDIR) ] 									\
		|| mkdir -p$(V) $(INSTDIR)
	$(E_mkD)[ -d $(BINDIR) ] 									\
		|| mkdir -p$(V) $(BINDIR)
	$(E_mkD)[ -d $(INSTDIR)/keymaps ] 						\
		|| mkdir -p$(V) $(INSTDIR)/keymaps
	$(E_mkD)[ -d $(INSTDIR)/include ] 						\
		|| mkdir -p$(V) $(INSTDIR)/include
	$(E_mkD)[ -d $(INSTDIR)/bin ] 							\
		|| mkdir -p$(V) $(INSTDIR)/bin
	$(E_mkD)[ -d $(INSTDIR)/lib ] 							\
		|| mkdir -p$(V) $(INSTDIR)/lib
	$(E_mkD)[ -d $(INSTDIR)/etc ] 							\
		|| mkdir -p$(V) $(INSTDIR)/etc
	$(E_mkD)[ -d $(INSTDIR)/doc ] 							\
		|| mkdir -p$(V) $(INSTDIR)/doc
	$(E_mkD)[ -d $(INSTDIR)/xDevilrc ] 						\
		|| mkdir -p$(V) $(INSTDIR)/xDevilrc
	$(E_mkD)[ -d $(INSTDIR)/locale.pot ] 					\
		|| mkdir -p$(V) $(INSTDIR)/locale.pot
	$(E_mkD)[ -d $(INSTDIR)/locale.po ] 					\
		|| mkdir -p$(V) $(INSTDIR)/locale.po
	$(E_mkD)[ -d $(INSTDIR)/locale.po/ru_RU.KOI8-R ] 	\
		|| mkdir -p$(V) $(INSTDIR)/locale.po/ru_RU.KOI8-R
	$(E_mkD)[ -d $(INSTDIR)/locale.mo ] 					\
		|| mkdir -p$(V) $(INSTDIR)/locale.mo

inst_xDevil :
	$(E_cd)cd $(xDevil_B_Dir) \
		&& chmod 0755 $(BINS) xDevil_bug$(SCRIPTSUFF) xDevilhash$(EXESUFF)
	$(E_xx)if [ "$(OSNAME)" = CYGWIN ] ; then echo "bash lowname %1 %2 %3 %4 %5 %6 %7 %8 %9" > $(xDevil_B_Dir)/lowname.bat ; fi
ifneq ($(BINDIR),$(xDevil_B_Dir))
	$(E_ln)ln -sf$(V) $(xDevil_B_Dir)/ci_xDevil$(EXESUFF) 					$(BINDIR)/
	$(E_ln)ln -sf$(V) $(xDevil_B_Dir)/xDevil_msgfmt$(SCRIPTSUFF) 	$(BINDIR)/
	$(E_ln)ln -sf$(V) $(xDevil_B_Dir)/xDevil_msgmerge$(SCRIPTSUFF) 	$(BINDIR)/
	$(E_ln)ln -sf$(V) $(xDevil_B_Dir)/xDevil_makeslib$(SCRIPTSUFF) 	$(BINDIR)/
	$(E_ln)ln -sf$(V) $(xDevil_B_Dir)/xDevil_makelib$(SCRIPTSUFF) 	$(BINDIR)/
	$(E_ln)ln -sf$(V) $(xDevil_B_Dir)/xDevil_cp$(SCRIPTSUFF) 			$(BINDIR)/
	$(E_ln)ln -sf$(V) $(xDevil_B_Dir)/xDevilar$(EXESUFF) 				$(BINDIR)/
	$(E_ln)ln -sf$(V) $(xDevil_B_Dir)/xDevilhash$(EXESUFF) 			$(BINDIR)/
	$(E_ln)ln -sf$(V) $(xDevil_B_Dir)/xDevil_bug$(SCRIPTSUFF) 		$(BINDIR)/
	$(E_ln)ln -sf$(V) $(xDevil_B_Dir)/xDevil_dbg$(EXESUFF) 			$(BINDIR)/
	$(E_ln)ln -sf$(V) $(xDevil_B_Dir)/xDevil_trans$(EXESUFF) 			$(BINDIR)/
	$(E_ln)ln -sf$(V) $(xDevil_B_Dir)/xDevil_conv$(EXESUFF) 			$(BINDIR)/
	$(E_ln)ln -sf$(V) $(xDevil_B_Dir)/xDevil_hashextract$(EXESUFF) 	$(BINDIR)/
endif
	$(E_xx)touch $(INSTDIR)/xDevilrc/.notrm

inst_locale :
	$(E_cp)cp --remove-destination -Rfpu$(V) locale.po/* $(INSTDIR)/locale.po
	$(E_rm)rm -rf$(V) `find $(INSTDIR)/locale.po -type d -name CVS -print`
	$(E_xx)xDevilROOT=$(INSTDIR) $(xDevil_B_Dir)/xDevil_msgfmt$(SCRIPTSUFF) $(INSTDIR)

inst_lib :

inst_std_lib :

inst_screen :

inst_codb :

inst_ch : #$(INST_MEMDEBUG_H)

inst_memdebug_h :

inst_doc :

inst_xDevil :

inst_end :
	$(E_xx)$(xDevil_B_Dir)/inst_end$(SCRIPTSUFF) $(INSTDIR) $(BINDIR)

include $(Makefile_end_in)

# DO NOT DELETE

