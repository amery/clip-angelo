#
#                                            xDevil/compiler/Makefile.in
#

Local_Depend 		= 			../include/*.ch ../include/*.h
Depend_on 			=

c_files				=
prg_files 			= 			$(sort	$(wildcard *.prg ) )
OBJDIR				= .
LIBS					= 			-lm
BIN 					=			xDevil$(EXESUFF)
BINS 					= 			$(BIN)

ADDOBJS 				=
DIRS_TO_SCAN 		=
xDevilFLAGS 			= 			-I include
ADDLIBS 				= 			$(ICONV_LIB)
o_files 				= 			$(addsuffix .o, $(basename $(prg_files) $(c_files) ) )
SRC_C_files 		= 			$(sort $(c_files) )
SRC_PRG_files 		= 			$(sort $(prg_files) )
E_xDevil 				=
export

######################################################################################
###################################################################################### local rules

all: Makefile links $(BIN)

links:
	$(E_ln)[ -L include ] || ln -sf$(V) $(xDevil_I_Dir) .

hash1 :
	$(E_xx)$(xDevil_M_Dir)/init/LinkAllFiles.sh xDevil-compiler

cfg:
	$(E_ln)[ -d charsets ] 											\
		|| ln -sf$(V) $(xDevilROOT)/charsets .

FORCE :

$(BIN):  $(prg_files) $(ADDOBJS) Makefile ../bin/xDevil $(Local_Depend)
	$(E_e)$(Trace_xDevil)
	$(E_e)echo "seq_no : " $(seq_no)
	$(E_xDevil)../bin/xDevil $(xDevilFLAGS) -M -g -R -v=6 -I. -eswlON -DSEQ_NO=\"$(seq_no)\" 	\
		-o $@ xDevil.prg														\
		$(ADDOBJS) $(ADDLIBS) $(MLIB)
	$(E_cp)cp --remove-destination -fuv $@ $(xDevil_B_Dir)/
	$(E_ln)ln -sf$(V) $(xDevil_B_Dir)/$@ $(BINDIR)/

cleanc :
	$(E_rm)rm -f$(V) charsets
	$(E_rm)rm -f$(V) $(BIN) *.b test dtest locale.pot *.c

distcleanc : clean
	$(E_rm)rm -f$(V) configure.flags *.g
	$(E_rm)rm -f$(V) xDevilcfg.sh xDevilcfg.h xDevil_msgmerge 					\
		xDevil_msgfmt xDevil_makeslib xDevil_makelib xDevil_cp 						\
		license.txt license.h
	$(E_rm)rm -f$(V) xDevilroot

install : all
	$(E_cp)cp --remove-destination -fpu$(V) $(BIN) $(xDevil_B_Dir)/

include $(Makefile_o_in)

include $(Makefile_end_in)
